function launchApp(){Trello.authorize({interactive:!1,success:onAuthorize})}function onAuthorize(){updateLoggedIn();var r=$("#boards");r.empty().append($("<p>").addClass("bigcenter").text("Loading Cards...")),Trello.members.get("me",function(e){$("#fullName").text(e.fullName),Trello.get("members/me/cards",function(e){var t=cardsByBoard(e),a=$(Mustache.render($("#template").html(),{boards:t}));r.empty().append(a),loadBoardAttributes(t)})})}function updateLoggedIn(){var r=Trello.authorized();$(".loggedout").toggle(!r),$(".loggedin").toggle(r)}function login(){Trello.authorize({type:"popup",success:onAuthorize})}function logout(){Trello.deauthorize(),updateLoggedIn()}function cardsByBoard(r){var e={};$.each(r,function(r,t){t.dueDate=t.due?new Date(t.due).toLocaleDateString():null;var a=e[t.idBoard]||{id:t.idBoard,cards:[]};a.cards.push(t),e[t.idBoard]=a});var t=[];for(b in e){var a=e[b];a.cards.sort(function(r,e){return r.due&&e.due?r.due<e.due:r.due?-1:e.due?1:r.name<e.name?-1:1}),t.push(a)}return t.sort(function(r,e){return r.cards.length>e.cards.length?-1:r.cards.length<e.cards.length?1:0}),t}function loadBoardAttributes(r){$.each(r,function(r,e){Trello.boards.get(e.id,{fields:"id,name,shortUrl,idOrganization,prefs"},function(r,e,t){var a=$("#board_"+r.id);a.find(".boardname").text(r.name),a.find("a").css("color",r.prefs.backgroundColor),r.idOrganization?(a.find(".orgname").addClass("org_"+r.idOrganization),loadOrgAttributes(r.idOrganization)):a.find(".orgname").html("<i>â€“</i>")},function(r,e,t){console.error("loadBoardAttributes failed",r,e,t)})})}function loadOrgAttributes(r){loadedOrgAttributes[r]?applyOrgAttributes(r):loadingOrg[r]||(loadingOrg[r]=!0,Trello.organizations.get(r,{fields:"id,name,displayName,url"},function(e,t,a){loadingOrg[r]=!1,loadedOrgAttributes[e.id]=e,applyOrgAttributes(r)},function(e,t,a){loadingOrg[r]=!1,console.error("loadOrgAttributes failed",e,t,a)}))}function applyOrgAttributes(r){var e=loadedOrgAttributes[r];$("#boards").find(".org_"+r).html("<a href="+e.url+' target="_blank">'+e.displayName+"</a>")}var loadingOrg=[],loadedOrgAttributes={};