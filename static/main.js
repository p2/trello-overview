function launchApp(){Trello.authorize({interactive:!1,success:onAuthorize})}function onAuthorize(){updateLoggedIn(),scheduleRefresh();var e=$("#boards");e.empty().append($("<p>").addClass("bigcenter").text("Loading Cards...")),Trello.members.get("me",function(r){$("#fullName").text(r.fullName),Trello.get("members/me/cards",function(r){var t=cardsByBoard(r),o=$(Mustache.render($("#template").html(),{boards:t}));e.empty().append(o),loadBoardAttributes(t)})},function(e,r,t){(t&&"unauthorized"==t.toLowerCase()||t&&t.includes("401"))&&(logout(),login())})}function updateLoggedIn(){var e=Trello.authorized();$(".loggedout").toggle(!e),$(".loggedin").toggle(e)}function login(){Trello.authorize({type:"popup",success:onAuthorize})}function logout(){Trello.deauthorize(),updateLoggedIn()}function scheduleRefresh(){clearRefresh(),_refreshDelaySecs>0&&(_refreshTimeout=window.setTimeout(doRefresh,1e3*_refreshDelaySecs))}function doRefresh(){clearRefresh(),onAuthorize()}function clearRefresh(){_refreshTimeout&&(window.clearTimeout(_refreshTimeout),_refreshTimeout=null)}function cardsByBoard(e){var r={};$.each(e,function(e,t){t.dueDate=t.due?new Date(t.due).toLocaleDateString():null;var o=r[t.idBoard]||{id:t.idBoard,cards:[]};o.cards.push(t),r[t.idBoard]=o});var t=[];for(b in r){var o=r[b];o.cards.sort(function(e,r){return e.due&&r.due?e.due<r.due:e.due?-1:r.due?1:e.name<r.name?-1:1}),t.push(o)}return t.sort(function(e,r){return e.cards.length>r.cards.length?-1:e.cards.length<r.cards.length?1:0}),t}function loadBoardAttributes(e){$.each(e,function(e,r){Trello.boards.get(r.id,{fields:"id,name,shortUrl,idOrganization,prefs"},function(e,r,t){var o=$("#board_"+e.id);o.find("a").css("color",e.prefs.backgroundColor);var a=$("<a>").text(e.name).attr("href",e.shortUrl).attr("target","_blank");o.find(".boardname").empty().append(a),e.idOrganization?(o.find(".orgname").addClass("org_"+e.idOrganization),loadOrgAttributes(e.idOrganization)):o.find(".orgname").html("<i>â€“</i>")},function(e,r,t){console.error("loadBoardAttributes failed",e,r,t)})})}function loadOrgAttributes(e){loadedOrgAttributes[e]?applyOrgAttributes(e):loadingOrg[e]||(loadingOrg[e]=!0,Trello.organizations.get(e,{fields:"id,name,displayName,url"},function(r,t,o){loadingOrg[e]=!1,loadedOrgAttributes[r.id]=r,applyOrgAttributes(e)},function(r,t,o){loadingOrg[e]=!1,console.error("loadOrgAttributes failed",r,t,o)}))}function applyOrgAttributes(e){var r=loadedOrgAttributes[e];$("#boards").find(".org_"+e).html("<a href="+r.url+' target="_blank">'+r.displayName+"</a>")}var _refreshDelaySecs=1800,_refreshTimeout=null,loadingOrg=[],loadedOrgAttributes={};