function launchApp(){Trello.authorize({interactive:!1,success:onAuthorize})}function onAuthorize(){updateLoggedIn();var r=$("#boards");r.empty().append($("<p>").addClass("bigcenter").text("Loading Cards...")),Trello.members.get("me",function(t){$("#fullName").text(t.fullName),Trello.get("members/me/cards",function(t){var e=cardsByBoard(t),a=$(Mustache.render($("#template").html(),{boards:e}));r.empty().append(a),loadBoardAttributes(e)})},function(r,t,e){e&&"unauthorized"==e.toLowerCase()&&(logout(),login())})}function updateLoggedIn(){var r=Trello.authorized();$(".loggedout").toggle(!r),$(".loggedin").toggle(r)}function login(){Trello.authorize({type:"popup",success:onAuthorize})}function logout(){Trello.deauthorize(),updateLoggedIn()}function cardsByBoard(r){var t={};$.each(r,function(r,e){e.dueDate=e.due?new Date(e.due).toLocaleDateString():null;var a=t[e.idBoard]||{id:e.idBoard,cards:[]};a.cards.push(e),t[e.idBoard]=a});var e=[];for(b in t){var a=t[b];a.cards.sort(function(r,t){return r.due&&t.due?r.due<t.due:r.due?-1:t.due?1:r.name<t.name?-1:1}),e.push(a)}return e.sort(function(r,t){return r.cards.length>t.cards.length?-1:r.cards.length<t.cards.length?1:0}),e}function loadBoardAttributes(r){$.each(r,function(r,t){Trello.boards.get(t.id,{fields:"id,name,shortUrl,idOrganization,prefs"},function(r,t,e){var a=$("#board_"+r.id);a.find("a").css("color",r.prefs.backgroundColor);var o=$("<a>").text(r.name).attr("href",r.shortUrl).attr("target","_blank");a.find(".boardname").empty().append(o),r.idOrganization?(a.find(".orgname").addClass("org_"+r.idOrganization),loadOrgAttributes(r.idOrganization)):a.find(".orgname").html("<i>â€“</i>")},function(r,t,e){console.error("loadBoardAttributes failed",r,t,e)})})}function loadOrgAttributes(r){loadedOrgAttributes[r]?applyOrgAttributes(r):loadingOrg[r]||(loadingOrg[r]=!0,Trello.organizations.get(r,{fields:"id,name,displayName,url"},function(t,e,a){loadingOrg[r]=!1,loadedOrgAttributes[t.id]=t,applyOrgAttributes(r)},function(t,e,a){loadingOrg[r]=!1,console.error("loadOrgAttributes failed",t,e,a)}))}function applyOrgAttributes(r){var t=loadedOrgAttributes[r];$("#boards").find(".org_"+r).html("<a href="+t.url+' target="_blank">'+t.displayName+"</a>")}var loadingOrg=[],loadedOrgAttributes={};